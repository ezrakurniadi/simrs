{% extends "base.html" %}

{% block title %}Patient Medications{% endblock %}

{% block content %}
<h1>Medications for {{ patient.first_name }} {{ patient.last_name }}</h1>

<div class="card">
  <div class="card-header">
    <h3>Current Medications</h3>
  </div>
  <div class="card-body">
    {% if medications %}
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Drug Name</th>
              <th>Dosage</th>
              <th>Frequency</th>
              <th>Start Date</th>
              <th>End Date</th>
              <th>Status</th>
              <th>Prescribed By</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for medication in medications %}
            <tr>
              <td>{{ medication.drug_name }}</td>
              <td>{{ medication.dosage }}</td>
              <td>{{ medication.frequency }}</td>
              <td>{{ medication.start_date.strftime('%Y-%m-%d') if medication.start_date else 'N/A' }}</td>
              <td>{{ medication.end_date.strftime('%Y-%m-%d') if medication.end_date else 'N/A' }}</td>
              <td>
                <span class="badge 
                  {% if medication.status == 'Active' %}bg-success
                  {% elif medication.status == 'Completed' %}bg-primary
                  {% elif medication.status == 'Discontinued' %}bg-danger
                  {% else %}bg-secondary{% endif %}">
                  {{ medication.status }}
                </span>
              </td>
              <td>{{ medication.prescriber.first_name }} {{ medication.prescriber.last_name }}</td>
              <td>
                <a href="{{ url_for('patients.edit_medication', patient_id=patient.id, medication_id=medication.id) }}" class="btn btn-sm btn-primary">Edit</a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p>No medications prescribed yet.</p>
    {% endif %}
    <a href="{{ url_for('patients.prescribe_medication', patient_id=patient.id) }}" class="btn btn-primary">Prescribe New Medication</a>
  </div>
</div>

<div class="mt-3">
  <a href="{{ url_for('patients.view_patient', id=patient.id) }}" class="btn btn-secondary">Back to Patient Details</a>
</div>
{% endblock %}