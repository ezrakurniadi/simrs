{% extends "base.html" %}

{% block title %}Patient Encounters{% endblock %}

{% block content %}
<h1>Patient Encounters</h1>

<div class="card">
  <div class="card-header">
    <h2>{{ patient.first_name }} {{ patient.last_name }}</h2>
  </div>
  <div class="card-body">
    <p><strong>Patient ID:</strong> {{ patient.id }}</p>
    <p><strong>Date of Birth:</strong> {{ patient.date_of_birth.strftime('%Y-%m-%d') if patient.date_of_birth else 'N/A' }}</p>
    <p><strong>Gender:</strong> {{ patient.gender }}</p>
  </div>
</div>

<div class="card mt-4">
  <div class="card-header">
    <h3>Chronological Encounters</h3>
  </div>
  <div class="card-body">
    {% if encounters %}
      <div class="timeline">
        {% for encounter in encounters %}
          <div class="timeline-item">
            <div class="row">
              <div class="col-md-3">
                <p><strong>Date:</strong> {{ encounter.date.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                <p><strong>Type:</strong> 
                  {% if encounter.type == 'clinical_note' %}
                    Clinical Note
                  {% elif encounter.type == 'vital_signs' %}
                    Vital Signs
                  {% elif encounter.type == 'lab_result' %}
                    Lab Result
                  {% endif %}
                </p>
              </div>
              <div class="col-md-9">
                {% if encounter.type == 'clinical_note' %}
                  <div class="encounter-details clinical-note">
                    <h5>{{ encounter.data.note_type }}</h5>
                    <p><strong>Written by:</strong> {{ encounter.data.author.first_name }} {{ encounter.data.author.last_name }}</p>
                    <p><strong>Content:</strong> {{ encounter.data.content }}</p>
                  </div>
                {% elif encounter.type == 'vital_signs' %}
                  <div class="encounter-details vital-signs">
                    <h5>Vital Signs</h5>
                    <p><strong>Recorded by:</strong> {{ encounter.data.recorder.first_name }} {{ encounter.data.recorder.last_name }}</p>
                    <div class="row">
                      <div class="col-md-6">
                        <p><strong>Blood Pressure:</strong> {{ encounter.data.bp_systolic or 'N/A' }}/{{ encounter.data.bp_diastolic or 'N/A' }} mmHg</p>
                        <p><strong>Heart Rate:</strong> {{ encounter.data.heart_rate or 'N/A' }} bpm</p>
                        <p><strong>Temperature:</strong> {{ encounter.data.temperature or 'N/A' }} Â°C</p>
                      </div>
                      <div class="col-md-6">
                        <p><strong>Weight:</strong> {{ encounter.data.weight or 'N/A' }} kg</p>
                        <p><strong>Height:</strong> {{ encounter.data.height or 'N/A' }} cm</p>
                      </div>
                    </div>
                  </div>
                {% elif encounter.type == 'lab_result' %}
                  <div class="encounter-details lab-result">
                    <h5>Lab Result - {{ encounter.data.order.test_type }}</h5>
                    <p><strong>Performed by:</strong> {{ encounter.data.result.performer.first_name }} {{ encounter.data.result.performer.last_name }}</p>
                    <p><strong>Result Date:</strong> {{ encounter.data.result.result_date.strftime('%Y-%m-%d %H:%M:%S') }}</p>
                    <div class="row">
                      <div class="col-md-12">
                        <p><strong>Result Data:</strong></p>
                        <pre>{{ encounter.data.result.result_data }}</pre>
                      </div>
                    </div>
                  </div>
                {% endif %}
                {% endif %}
              </div>
            </div>
            <hr>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No encounters recorded for this patient.</p>
    {% endif %}
  </div>
</div>

<div class="mt-3">
  <a href="{{ url_for('patients.view_patient', id=patient.id) }}" class="btn btn-secondary">Back to Patient Chart</a>
</div>
{% endblock %}

{% block styles %}
<style>
.timeline-item {
  margin-bottom: 20px;
}

.encounter-details {
  padding: 15px;
  border-radius: 5px;
}

.clinical-note {
  background-color: #e8f4f8;
  border-left: 4px solid #007bff;
}

.vital-signs {
  background-color: #f8f4e8;
  border-left: 4px solid #28a745;

.lab-result {
  background-color: #f0f8ff;
  border-left: 4px solid #6c757d;
}
}
</style>
{% endblock %}