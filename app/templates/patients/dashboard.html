{% extends "base.html" %}

{% block title %}Patient Dashboard - EHR System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1>Patient Dashboard</h1>
        <p>Welcome, {{ current_user.patient.first_name }} {{ current_user.patient.last_name }}!</p>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Your Information</h5>
            </div>
            <div class="card-body">
                <p><strong>Name:</strong> {{ current_user.patient.first_name }} {{ current_user.patient.last_name }}</p>
                <p><strong>Email:</strong> {{ current_user.patient.email }}</p>
                <p><strong>Phone:</strong> {{ current_user.patient.phone or 'Not provided' }}</p>
                <p><strong>Date of Birth:</strong> {{ current_user.patient.date_of_birth }}</p>
                <p><strong>Gender:</strong> {{ current_user.patient.gender }}</p>
                <a href="{{ url_for('patients.view_patient', id=current_user.patient.id) }}" class="btn btn-primary">View Full Profile</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Your Appointments</h5>
            </div>
            <div class="card-body">
                <h6>Upcoming Appointments</h6>
                {% if upcoming_appointments %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Doctor</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for appointment in upcoming_appointments %}
                                <tr>
                                    <td>{{ appointment.scheduled_time.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>Dr. {{ appointment.doctor.first_name }} {{ appointment.doctor.last_name }}</td>
                                    <td>{{ appointment.status }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>You have no upcoming appointments.</p>
                {% endif %}
                
                <h6 class="mt-3">Recent Appointments</h6>
                {% if appointment_history %}
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Doctor</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for appointment in appointment_history %}
                                <tr>
                                    <td>{{ appointment.scheduled_time.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>Dr. {{ appointment.doctor.first_name }} {{ appointment.doctor.last_name }}</td>
                                    <td>{{ appointment.status }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p>You have no appointment history.</p>
                {% endif %}
                
                <a href="{{ url_for('appointments.list_appointments') }}" class="btn btn-primary">View All Appointments</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-3">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Your Medical Records</h5>
            </div>
            <div class="card-body">
                <p>View your medical history, vitals, medications, and allergies.</p>
                <a href="{{ url_for('patients.view_patient', id=current_user.patient.id) }}#vitals" class="btn btn-primary">View Vitals</a>
                <a href="{{ url_for('patients.view_patient', id=current_user.patient.id) }}#medications" class="btn btn-primary">View Medications</a>
                <a href="{{ url_for('patients.view_patient', id=current_user.patient.id) }}#allergies" class="btn btn-primary">View Allergies</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Quick Actions</h5>
            </div>
            <div class="card-body">
                <a href="#" class="btn btn-primary">Request Appointment</a>
                <a href="{{ url_for('patients.view_lab_results') }}" class="btn btn-primary">View Test Results</a>
                <a href="{{ url_for('patient_auth.patient_logout') }}" class="btn btn-secondary">Logout</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}